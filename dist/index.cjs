function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=/*#__PURE__*/e(require("axios"));function n(){return"undefined"!=typeof window}function o(e,r){try{var n=e()}catch(e){return r(e)}return n&&n.then?n.then(void 0,r):n}var t={initialized:!1,projectId:-1,api:r.default.create()};function i(e,r){try{var n=e()}catch(e){return r(!0,e)}return n&&n.then?n.then(r.bind(null,!1),r.bind(null,!0)):r(!1,n)}function u(){if(!t.initialized)throw new Error("[COREEND] SDK has not been initialized")}var s={isSignedIn:!1,accessToken:"",refreshToken:"",expiresOn:0};function c(){var e=function(){try{try{if(!h())throw new Error("Not signed in");return n()&&window.localStorage.removeItem(f),s.isSignedIn=!1,s.accessToken="",s.refreshToken="",s.expiresOn=0,Promise.resolve({error:null})}catch(e){return Promise.resolve({error:e})}}catch(e){return Promise.reject(e)}},r=function(){return Promise.resolve(o(function(){if(!h())throw new Error("Not signed in");return Promise.resolve(t.api.post("auth/renew",{refreshToken:s.refreshToken})).then(function(e){return s.accessToken=e.data.accessToken,s.expiresOn=Date.now()+6e4*a,{error:null}})},function(r){return Promise.resolve(e()).then(function(){return{error:r}})}))},c=function(){return Promise.resolve(o(function(){function n(e){return{error:null,accessToken:s.accessToken}}if(!h())throw new Error("Not signed in");var o=function(){if(Date.now()>=s.expiresOn-3e4)return Promise.resolve(r()).then(function(r){return function(){if(r.error)return Promise.resolve(e()).then(function(){throw new Error("Could not renew access token")})}()})}();return o&&o.then?o.then(n):n()},function(r){return Promise.resolve(e()).then(function(){return{error:r,accessToken:null}})}))};u();var a=15,f="coreend-sdk-authentication-refreshToken";if(!s.isSignedIn&&n()){var l=window.localStorage.getItem(f);l&&(s.refreshToken=l,s.isSignedIn=!0)}function h(){return s.isSignedIn}return{isSignedIn:h,getAccessToken:c,login:function(e){return Promise.resolve(o(function(){if(h())throw new Error("Already signed in");return Promise.resolve(t.api.post("auth/login",{email:e})).then(function(){return{error:null}})},function(e){return{error:e}}))},verify:function(e,r){return Promise.resolve(o(function(){if(h())throw new Error("Already signed in");return Promise.resolve(t.api.post("auth/verify",{email:e,otp:r})).then(function(e){if(s.accessToken=e.data.accessToken||"",s.refreshToken=e.data.refreshToken||"",s.expiresOn=Date.now()+6e4*a,s.isSignedIn=!0,!s.accessToken||!s.refreshToken)throw new Error("Could not sign in");return n()&&window.localStorage.setItem(f,s.refreshToken),{error:null}})},function(e){return{error:e}}))},profile:function(){return Promise.resolve(o(function(){if(!h())throw new Error("Not signed in");return Promise.resolve(c()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);return Promise.resolve(t.api.get("auth/profile",{headers:{Authorization:"Bearer "+e.accessToken}})).then(function(e){var r={uid:e.data.uid||"",email:e.data.email||""};if(!r.uid||!r.email)throw new Error("Could not get profile");return{error:null,profile:r}})})},function(e){return{error:e,profile:null}}))},renew:r,invalidate:function(){return Promise.resolve(i(function(){return o(function(){if(!h())throw new Error("Not signed in");return Promise.resolve(t.api.post("auth/invalidate",{refreshToken:s.refreshToken})).then(function(){return{error:null}})},function(e){return{error:e}})},function(r,n){return Promise.resolve(e()).then(function(){if(r)throw n;return n})}))},remove:function(){return Promise.resolve(i(function(){return o(function(){if(!h())throw new Error("Not signed in");return Promise.resolve(c()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);return Promise.resolve(t.api.delete("auth/remove",{headers:{Authorization:"Bearer "+e.accessToken}})).then(function(){return{error:null}})})},function(e){return{error:e}})},function(r,n){return Promise.resolve(e()).then(function(){if(r)throw n;return n})}))},logout:e}}exports.authentication=c,exports.initCoreEnd=function(e){if(t.initialized)throw new Error("[COREEND] SDK has already been initialized");t.projectId=e,t.api=r.default.create({baseURL:"https://api.coreend.tech/v1/projects/"+e+"/"}),t.initialized=!0},exports.resourceDocs=function(e){return u(),{get:function(r){var n=void 0===r?{}:r,i=n.id,u=n.page,s=n.requireAuth;try{return Promise.resolve(o(function(){function r(r){return Promise.resolve(t.api.get("resources/"+e+"/docs/"+n+"?"+o,{headers:a})).then(function(e){return{error:null,items:e.data}})}var n="number"==typeof i?i:"",o="number"==typeof u?"page="+u:"",a={},f=function(){if(s){var e=c();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);a.Authorization="Bearer "+e.accessToken})}}();return f&&f.then?f.then(r):r()},function(e){return{error:e,items:null}}))}catch(e){return Promise.reject(e)}},create:function(r,n,i){void 0===n&&(n=!1),void 0===i&&(i="");try{return Promise.resolve(o(function(){function o(n){return Promise.resolve(t.api.post("resources/"+e+"/docs?"+(i?"hcaptchaResponse="+i+"&":""),{data:r},{headers:u})).then(function(e){return{error:null,id:e.data}})}var u={},s=function(){if(n){var e=c();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);u.Authorization="Bearer "+e.accessToken})}}();return s&&s.then?s.then(o):o()},function(e){return{error:e,id:null}}))}catch(e){return Promise.reject(e)}},update:function(r,n){return void 0===n&&(n=!1),Promise.resolve(o(function(){function o(n){return Promise.resolve(t.api.put("resources/"+e+"/docs",{data:r},{headers:i})).then(function(){return{error:null}})}var i={},u=function(){if(n){var e=c();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);i.Authorization="Bearer "+e.accessToken})}}();return u&&u.then?u.then(o):o()},function(e){return{error:e}}))},remove:function(r,n){return void 0===n&&(n=!1),Promise.resolve(o(function(){function o(n){return Promise.resolve(t.api.delete("resources/"+e+"/docs/"+r,{headers:i})).then(function(){return{error:null}})}var i={},u=function(){if(n){var e=c();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);i.Authorization="Bearer "+e.accessToken})}}();return u&&u.then?u.then(o):o()},function(e){return{error:e}}))}}},exports.storageFiles=function(e){return u(),{get:function(r,n){void 0===n&&(n=!1);try{return Promise.resolve(o(function(){function o(n){return Promise.resolve(t.api.get("storages/"+e+"/files/"+r,{headers:i})).then(function(e){return{error:null,url:e.data.url}})}var i={},u=function(){if(n){var e=c();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);i.Authorization="Bearer "+e.accessToken})}}();return u&&u.then?u.then(o):o()},function(e){return{error:e,url:null}}))}catch(e){return Promise.reject(e)}},create:function(r,n,i,u){return void 0===i&&(i=!1),void 0===u&&(u=""),Promise.resolve(o(function(){function o(o){var i=new FormData;return i.append("file",r),i.append("fileName",n||r.name),Promise.resolve(t.api.post("storages/"+e+"/files?"+(u?"hcaptchaResponse="+u+"&":""),i,{headers:s})).then(function(){return{error:null}})}var s={},a=function(){if(i){var e=c();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);s.Authorization="Bearer "+e.accessToken})}}();return a&&a.then?a.then(o):o()},function(e){return{error:e}}))},remove:function(r,n){return void 0===n&&(n=!1),Promise.resolve(o(function(){function o(n){return Promise.resolve(t.api.delete("storages/"+e+"/files/"+r,{headers:i})).then(function(){return{error:null}})}var i={},u=function(){if(n){var e=c();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);i.Authorization="Bearer "+e.accessToken})}}();return u&&u.then?u.then(o):o()},function(e){return{error:e}}))}}};
//# sourceMappingURL=index.cjs.map
