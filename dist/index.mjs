import e from"axios";function r(){return"undefined"!=typeof window}function n(e,r){try{var n=e()}catch(e){return r(e)}return n&&n.then?n.then(void 0,r):n}var o={initialized:!1,projectId:-1,api:e.create()};function t(e,r){try{var n=e()}catch(e){return r(!0,e)}return n&&n.then?n.then(r.bind(null,!1),r.bind(null,!0)):r(!1,n)}function i(r){if(o.initialized)throw new Error("[COREEND] SDK has already been initialized");o.projectId=r,o.api=e.create({baseURL:"https://api.coreend.tech/v1/projects/"+r+"/"}),o.initialized=!0}function u(){if(!o.initialized)throw new Error("[COREEND] SDK has not been initialized")}function s(e){return u(),{get:function(r){var t=void 0===r?{}:r,i=t.id,u=t.page,s=t.requireAuth;try{return Promise.resolve(n(function(){function r(r){return Promise.resolve(o.api.get("resources/"+e+"/docs/"+n+"?"+t,{headers:c})).then(function(e){return{error:null,items:e.data}})}var n="number"==typeof i?i:"",t="number"==typeof u?"page="+u:"",c={},f=function(){if(s){var e=a();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);c.Authorization="Bearer "+e.accessToken})}}();return f&&f.then?f.then(r):r()},function(e){return{error:e,items:null}}))}catch(e){return Promise.reject(e)}},create:function(r,t,i){void 0===t&&(t=!1),void 0===i&&(i="");try{return Promise.resolve(n(function(){function n(n){return Promise.resolve(o.api.post("resources/"+e+"/docs?"+(i?"hcaptchaResponse="+i+"&":""),{data:r},{headers:u})).then(function(e){return{error:null,id:e.data}})}var u={},s=function(){if(t){var e=a();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);u.Authorization="Bearer "+e.accessToken})}}();return s&&s.then?s.then(n):n()},function(e){return{error:e,id:null}}))}catch(e){return Promise.reject(e)}},update:function(r,t){return void 0===t&&(t=!1),Promise.resolve(n(function(){function n(n){return Promise.resolve(o.api.put("resources/"+e+"/docs",{data:r},{headers:i})).then(function(){return{error:null}})}var i={},u=function(){if(t){var e=a();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);i.Authorization="Bearer "+e.accessToken})}}();return u&&u.then?u.then(n):n()},function(e){return{error:e}}))},remove:function(r,t){return void 0===t&&(t=!1),Promise.resolve(n(function(){function n(n){return Promise.resolve(o.api.delete("resources/"+e+"/docs/"+r,{headers:i})).then(function(){return{error:null}})}var i={},u=function(){if(t){var e=a();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);i.Authorization="Bearer "+e.accessToken})}}();return u&&u.then?u.then(n):n()},function(e){return{error:e}}))}}}var c={isSignedIn:!1,accessToken:"",refreshToken:"",expiresOn:0};function a(){var e=function(){try{try{if(!h())throw new Error("Not signed in");return r()&&window.localStorage.removeItem(f),c.isSignedIn=!1,c.accessToken="",c.refreshToken="",c.expiresOn=0,Promise.resolve({error:null})}catch(e){return Promise.resolve({error:e})}}catch(e){return Promise.reject(e)}},i=function(){return Promise.resolve(n(function(){if(!h())throw new Error("Not signed in");return Promise.resolve(o.api.post("auth/renew",{refreshToken:c.refreshToken})).then(function(e){return c.accessToken=e.data.accessToken,c.expiresOn=Date.now()+6e4*a,{error:null}})},function(r){return Promise.resolve(e()).then(function(){return{error:r}})}))},s=function(){return Promise.resolve(n(function(){function r(e){return{error:null,accessToken:c.accessToken}}if(!h())throw new Error("Not signed in");var n=function(){if(Date.now()>=c.expiresOn-3e4)return Promise.resolve(i()).then(function(r){return function(){if(r.error)return Promise.resolve(e()).then(function(){throw new Error("Could not renew access token")})}()})}();return n&&n.then?n.then(r):r()},function(r){return Promise.resolve(e()).then(function(){return{error:r,accessToken:null}})}))};u();var a=15,f="coreend-sdk-authentication-refreshToken";if(!c.isSignedIn&&r()){var l=window.localStorage.getItem(f);l&&(c.refreshToken=l,c.isSignedIn=!0)}function h(){return c.isSignedIn}return{isSignedIn:h,getAccessToken:s,login:function(e){return Promise.resolve(n(function(){if(h())throw new Error("Already signed in");return Promise.resolve(o.api.post("auth/login",{email:e})).then(function(){return{error:null}})},function(e){return{error:e}}))},verify:function(e,t){return Promise.resolve(n(function(){if(h())throw new Error("Already signed in");return Promise.resolve(o.api.post("auth/verify",{email:e,otp:t})).then(function(e){if(c.accessToken=e.data.accessToken||"",c.refreshToken=e.data.refreshToken||"",c.expiresOn=Date.now()+6e4*a,c.isSignedIn=!0,!c.accessToken||!c.refreshToken)throw new Error("Could not sign in");return r()&&window.localStorage.setItem(f,c.refreshToken),{error:null}})},function(e){return{error:e}}))},profile:function(){return Promise.resolve(n(function(){if(!h())throw new Error("Not signed in");return Promise.resolve(s()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);return Promise.resolve(o.api.get("auth/profile",{headers:{Authorization:"Bearer "+e.accessToken}})).then(function(e){var r={uid:e.data.uid||"",email:e.data.email||""};if(!r.uid||!r.email)throw new Error("Could not get profile");return{error:null,profile:r}})})},function(e){return{error:e,profile:null}}))},renew:i,invalidate:function(){return Promise.resolve(t(function(){return n(function(){if(!h())throw new Error("Not signed in");return Promise.resolve(o.api.post("auth/invalidate",{refreshToken:c.refreshToken})).then(function(){return{error:null}})},function(e){return{error:e}})},function(r,n){return Promise.resolve(e()).then(function(){if(r)throw n;return n})}))},remove:function(){return Promise.resolve(t(function(){return n(function(){if(!h())throw new Error("Not signed in");return Promise.resolve(s()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);return Promise.resolve(o.api.delete("auth/remove",{headers:{Authorization:"Bearer "+e.accessToken}})).then(function(){return{error:null}})})},function(e){return{error:e}})},function(r,n){return Promise.resolve(e()).then(function(){if(r)throw n;return n})}))},logout:e}}function f(e){return u(),{get:function(r,t){void 0===t&&(t=!1);try{return Promise.resolve(n(function(){function n(n){return Promise.resolve(o.api.get("storages/"+e+"/files/"+r,{headers:i})).then(function(e){return{error:null,url:e.data.url}})}var i={},u=function(){if(t){var e=a();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);i.Authorization="Bearer "+e.accessToken})}}();return u&&u.then?u.then(n):n()},function(e){return{error:e,url:null}}))}catch(e){return Promise.reject(e)}},create:function(r,t,i,u){return void 0===i&&(i=!1),void 0===u&&(u=""),Promise.resolve(n(function(){function n(n){var i=new FormData;return i.append("file",r),i.append("fileName",t||r.name),Promise.resolve(o.api.post("storages/"+e+"/files?"+(u?"hcaptchaResponse="+u+"&":""),i,{headers:s})).then(function(){return{error:null}})}var s={},c=function(){if(i){var e=a();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);s.Authorization="Bearer "+e.accessToken})}}();return c&&c.then?c.then(n):n()},function(e){return{error:e}}))},remove:function(r,t){return void 0===t&&(t=!1),Promise.resolve(n(function(){function n(n){return Promise.resolve(o.api.delete("storages/"+e+"/files/"+r,{headers:i})).then(function(){return{error:null}})}var i={},u=function(){if(t){var e=a();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);i.Authorization="Bearer "+e.accessToken})}}();return u&&u.then?u.then(n):n()},function(e){return{error:e}}))}}}export{a as authentication,i as initCoreEnd,s as resourceDocs,f as storageFiles};
//# sourceMappingURL=index.mjs.map
