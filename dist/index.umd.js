!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("axios")):"function"==typeof define&&define.amd?define(["exports","axios"],r):r((e||self).coreendSdk={},e.axios)}(this,function(e,r){function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=/*#__PURE__*/n(r);function t(){return"undefined"!=typeof window}function i(e,r){try{var n=e()}catch(e){return r(e)}return n&&n.then?n.then(void 0,r):n}var u={initialized:!1,projectId:-1,api:o.default.create()};function s(e,r){try{var n=e()}catch(e){return r(!0,e)}return n&&n.then?n.then(r.bind(null,!1),r.bind(null,!0)):r(!1,n)}function c(){if(!u.initialized)throw new Error("[COREEND] SDK has not been initialized")}var a={isSignedIn:!1,accessToken:"",refreshToken:"",expiresOn:0};function f(){var e=function(){try{try{if(!h())throw new Error("Not signed in");return t()&&window.localStorage.removeItem(f),a.isSignedIn=!1,a.accessToken="",a.refreshToken="",a.expiresOn=0,Promise.resolve({error:null})}catch(e){return Promise.resolve({error:e})}}catch(e){return Promise.reject(e)}},r=function(){return Promise.resolve(i(function(){if(!h())throw new Error("Not signed in");return Promise.resolve(u.api.post("auth/renew",{refreshToken:a.refreshToken})).then(function(e){return a.accessToken=e.data.accessToken,a.expiresOn=Date.now()+6e4*o,{error:null}})},function(r){return Promise.resolve(e()).then(function(){return{error:r}})}))},n=function(){return Promise.resolve(i(function(){function n(e){return{error:null,accessToken:a.accessToken}}if(!h())throw new Error("Not signed in");var o=function(){if(Date.now()>=a.expiresOn-3e4)return Promise.resolve(r()).then(function(r){return function(){if(r.error)return Promise.resolve(e()).then(function(){throw new Error("Could not renew access token")})}()})}();return o&&o.then?o.then(n):n()},function(r){return Promise.resolve(e()).then(function(){return{error:r,accessToken:null}})}))};c();var o=15,f="coreend-sdk-authentication-refreshToken";if(!a.isSignedIn&&t()){var l=window.localStorage.getItem(f);l&&(a.refreshToken=l,a.isSignedIn=!0)}function h(){return a.isSignedIn}return{isSignedIn:h,getAccessToken:n,login:function(e){return Promise.resolve(i(function(){if(h())throw new Error("Already signed in");return Promise.resolve(u.api.post("auth/login",{email:e})).then(function(){return{error:null}})},function(e){return{error:e}}))},verify:function(e,r){return Promise.resolve(i(function(){if(h())throw new Error("Already signed in");return Promise.resolve(u.api.post("auth/verify",{email:e,otp:r})).then(function(e){if(a.accessToken=e.data.accessToken||"",a.refreshToken=e.data.refreshToken||"",a.expiresOn=Date.now()+6e4*o,a.isSignedIn=!0,!a.accessToken||!a.refreshToken)throw new Error("Could not sign in");return t()&&window.localStorage.setItem(f,a.refreshToken),{error:null}})},function(e){return{error:e}}))},profile:function(){return Promise.resolve(i(function(){if(!h())throw new Error("Not signed in");return Promise.resolve(n()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);return Promise.resolve(u.api.get("auth/profile",{headers:{Authorization:"Bearer "+e.accessToken}})).then(function(e){var r={uid:e.data.uid||"",email:e.data.email||""};if(!r.uid||!r.email)throw new Error("Could not get profile");return{error:null,profile:r}})})},function(e){return{error:e,profile:null}}))},renew:r,invalidate:function(){return Promise.resolve(s(function(){return i(function(){if(!h())throw new Error("Not signed in");return Promise.resolve(u.api.post("auth/invalidate",{refreshToken:a.refreshToken})).then(function(){return{error:null}})},function(e){return{error:e}})},function(r,n){return Promise.resolve(e()).then(function(){if(r)throw n;return n})}))},remove:function(){return Promise.resolve(s(function(){return i(function(){if(!h())throw new Error("Not signed in");return Promise.resolve(n()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);return Promise.resolve(u.api.delete("auth/remove",{headers:{Authorization:"Bearer "+e.accessToken}})).then(function(){return{error:null}})})},function(e){return{error:e}})},function(r,n){return Promise.resolve(e()).then(function(){if(r)throw n;return n})}))},logout:e}}e.authentication=f,e.initCoreEnd=function(e){if(u.initialized)throw new Error("[COREEND] SDK has already been initialized");u.projectId=e,u.api=o.default.create({baseURL:"https://api.coreend.tech/v1/projects/"+e+"/"}),u.initialized=!0},e.resourceDocs=function(e){return c(),{get:function(r){var n=void 0===r?{}:r,o=n.id,t=n.page,s=n.requireAuth;try{return Promise.resolve(i(function(){function r(r){return Promise.resolve(u.api.get("resources/"+e+"/docs/"+n+"?"+i,{headers:c})).then(function(e){return{error:null,items:e.data}})}var n="number"==typeof o?o:"",i="number"==typeof t?"page="+t:"",c={},a=function(){if(s){var e=f();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);c.Authorization="Bearer "+e.accessToken})}}();return a&&a.then?a.then(r):r()},function(e){return{error:e,items:null}}))}catch(e){return Promise.reject(e)}},create:function(r,n,o){void 0===n&&(n=!1),void 0===o&&(o="");try{return Promise.resolve(i(function(){function t(n){return Promise.resolve(u.api.post("resources/"+e+"/docs?"+(o?"hcaptchaResponse="+o+"&":""),{data:r},{headers:i})).then(function(e){return{error:null,id:e.data}})}var i={},s=function(){if(n){var e=f();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);i.Authorization="Bearer "+e.accessToken})}}();return s&&s.then?s.then(t):t()},function(e){return{error:e,id:null}}))}catch(e){return Promise.reject(e)}},update:function(r,n){return void 0===n&&(n=!1),Promise.resolve(i(function(){function o(n){return Promise.resolve(u.api.put("resources/"+e+"/docs",{data:r},{headers:t})).then(function(){return{error:null}})}var t={},i=function(){if(n){var e=f();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);t.Authorization="Bearer "+e.accessToken})}}();return i&&i.then?i.then(o):o()},function(e){return{error:e}}))},remove:function(r,n){return void 0===n&&(n=!1),Promise.resolve(i(function(){function o(n){return Promise.resolve(u.api.delete("resources/"+e+"/docs/"+r,{headers:t})).then(function(){return{error:null}})}var t={},i=function(){if(n){var e=f();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);t.Authorization="Bearer "+e.accessToken})}}();return i&&i.then?i.then(o):o()},function(e){return{error:e}}))}}},e.storageFiles=function(e){return c(),{get:function(r,n){void 0===n&&(n=!1);try{return Promise.resolve(i(function(){function o(n){return Promise.resolve(u.api.get("storages/"+e+"/files/"+r,{headers:t})).then(function(e){return{error:null,url:e.data.url}})}var t={},i=function(){if(n){var e=f();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);t.Authorization="Bearer "+e.accessToken})}}();return i&&i.then?i.then(o):o()},function(e){return{error:e,url:null}}))}catch(e){return Promise.reject(e)}},create:function(r,n,o,t){return void 0===o&&(o=!1),void 0===t&&(t=""),Promise.resolve(i(function(){function i(o){var i=new FormData;return i.append("file",r),i.append("fileName",n||r.name),Promise.resolve(u.api.post("storages/"+e+"/files?"+(t?"hcaptchaResponse="+t+"&":""),i,{headers:s})).then(function(){return{error:null}})}var s={},c=function(){if(o){var e=f();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);s.Authorization="Bearer "+e.accessToken})}}();return c&&c.then?c.then(i):i()},function(e){return{error:e}}))},remove:function(r,n){return void 0===n&&(n=!1),Promise.resolve(i(function(){function o(n){return Promise.resolve(u.api.delete("storages/"+e+"/files/"+r,{headers:t})).then(function(){return{error:null}})}var t={},i=function(){if(n){var e=f();return Promise.resolve(e.getAccessToken()).then(function(e){if(e.error)throw new Error("Can not get access token: "+e.error);t.Authorization="Bearer "+e.accessToken})}}();return i&&i.then?i.then(o):o()},function(e){return{error:e}}))}}}});
//# sourceMappingURL=index.umd.js.map
