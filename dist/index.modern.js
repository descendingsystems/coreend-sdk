import r from"axios";function e(){return"undefined"!=typeof window}const n={initialized:!1,projectId:-1,api:r.create()};function t(e){if(n.initialized)throw new Error("[COREEND] SDK has already been initialized");n.projectId=e,n.api=r.create({baseURL:`https://api.coreend.tech/v1/projects/${e}/`}),n.initialized=!0}function o(){if(!n.initialized)throw new Error("[COREEND] SDK has not been initialized")}function a(r){return o(),{get:async function({id:e,page:t,requireAuth:o}={}){try{const a="number"==typeof e?e:"",i="number"==typeof t?`page=${t}`:"",c={};if(o){const r=s(),e=await r.getAccessToken();if(e.error)throw new Error(`Can not get access token: ${e.error}`);c.Authorization=`Bearer ${e.accessToken}`}return{error:null,items:(await n.api.get(`resources/${r}/docs/${a}?${i}`,{headers:c})).data}}catch(r){return{error:r,items:null}}},create:async function(e,t=!1,o=""){try{const a={};if(t){const r=s(),e=await r.getAccessToken();if(e.error)throw new Error(`Can not get access token: ${e.error}`);a.Authorization=`Bearer ${e.accessToken}`}const i=o?`hcaptchaResponse=${o}&`:"";return{error:null,id:(await n.api.post(`resources/${r}/docs?${i}`,{data:e},{headers:a})).data}}catch(r){return{error:r,id:null}}},update:async function(e,t=!1){try{const o={};if(t){const r=s(),e=await r.getAccessToken();if(e.error)throw new Error(`Can not get access token: ${e.error}`);o.Authorization=`Bearer ${e.accessToken}`}return await n.api.put(`resources/${r}/docs`,{data:e},{headers:o}),{error:null}}catch(r){return{error:r}}},remove:async function(e,t=!1){try{const o={};if(t){const r=s(),e=await r.getAccessToken();if(e.error)throw new Error(`Can not get access token: ${e.error}`);o.Authorization=`Bearer ${e.accessToken}`}return await n.api.delete(`resources/${r}/docs/${e}`,{headers:o}),{error:null}}catch(r){return{error:r}}}}}const i={isSignedIn:!1,accessToken:"",refreshToken:"",expiresOn:0};function s(){o();const r="coreend-sdk-authentication-refreshToken";if(!i.isSignedIn&&e()){const e=window.localStorage.getItem(r);e&&(i.refreshToken=e,i.isSignedIn=!0)}function t(){return i.isSignedIn}async function a(){try{if(!t())throw new Error("Not signed in");if(Date.now()>=i.expiresOn-3e4&&(await s()).error)throw await c(),new Error("Could not renew access token");return{error:null,accessToken:i.accessToken}}catch(r){return await c(),{error:r,accessToken:null}}}async function s(){try{if(!t())throw new Error("Not signed in");const r=await n.api.post("auth/renew",{refreshToken:i.refreshToken});return i.accessToken=r.data.accessToken,i.expiresOn=Date.now()+9e5,{error:null}}catch(r){return await c(),{error:r}}}async function c(){try{if(!t())throw new Error("Not signed in");return e()&&window.localStorage.removeItem(r),i.isSignedIn=!1,i.accessToken="",i.refreshToken="",i.expiresOn=0,{error:null}}catch(r){return{error:r}}}return{isSignedIn:t,getAccessToken:a,login:async function(r){try{if(t())throw new Error("Already signed in");return await n.api.post("auth/login",{email:r}),{error:null}}catch(r){return{error:r}}},verify:async function(o,a){try{if(t())throw new Error("Already signed in");const s=await n.api.post("auth/verify",{email:o,otp:a});if(i.accessToken=s.data.accessToken||"",i.refreshToken=s.data.refreshToken||"",i.expiresOn=Date.now()+9e5,i.isSignedIn=!0,!i.accessToken||!i.refreshToken)throw new Error("Could not sign in");return e()&&window.localStorage.setItem(r,i.refreshToken),{error:null}}catch(r){return{error:r}}},profile:async function(){try{if(!t())throw new Error("Not signed in");const r=await a();if(r.error)throw new Error(`Can not get access token: ${r.error}`);const e=await n.api.get("auth/profile",{headers:{Authorization:`Bearer ${r.accessToken}`}}),o={uid:e.data.uid||"",email:e.data.email||""};if(!o.uid||!o.email)throw new Error("Could not get profile");return{error:null,profile:o}}catch(r){return{error:r,profile:null}}},renew:s,invalidate:async function(){try{if(!t())throw new Error("Not signed in");return await n.api.post("auth/invalidate",{refreshToken:i.refreshToken}),{error:null}}catch(r){return{error:r}}finally{await c()}},remove:async function(){try{if(!t())throw new Error("Not signed in");const r=await a();if(r.error)throw new Error(`Can not get access token: ${r.error}`);return await n.api.delete("auth/remove",{headers:{Authorization:`Bearer ${r.accessToken}`}}),{error:null}}catch(r){return{error:r}}finally{await c()}},logout:c}}function c(r){return o(),{get:async function(e,t=!1){try{const o={};if(t){const r=s(),e=await r.getAccessToken();if(e.error)throw new Error(`Can not get access token: ${e.error}`);o.Authorization=`Bearer ${e.accessToken}`}return{error:null,url:(await n.api.get(`storages/${r}/files/${e}`,{headers:o})).data.url}}catch(r){return{error:r,url:null}}},create:async function(e,t,o=!1,a=""){try{const i={};if(o){const r=s(),e=await r.getAccessToken();if(e.error)throw new Error(`Can not get access token: ${e.error}`);i.Authorization=`Bearer ${e.accessToken}`}const c=new FormData;c.append("file",e),c.append("fileName",t||e.name);const u=a?`hcaptchaResponse=${a}&`:"";return await n.api.post(`storages/${r}/files?${u}`,c,{headers:i}),{error:null}}catch(r){return{error:r}}},remove:async function(e,t=!1){try{const o={};if(t){const r=s(),e=await r.getAccessToken();if(e.error)throw new Error(`Can not get access token: ${e.error}`);o.Authorization=`Bearer ${e.accessToken}`}return await n.api.delete(`storages/${r}/files/${e}`,{headers:o}),{error:null}}catch(r){return{error:r}}}}}export{s as authentication,t as initCoreEnd,a as resourceDocs,c as storageFiles};
//# sourceMappingURL=index.modern.js.map
